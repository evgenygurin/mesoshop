{{ header }}
<div id="account-password" class="container">
  <ul class="breadcrumb">
    {% for breadcrumb in breadcrumbs %}
      <li class="breadcrumb-item"><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
    {% endfor %}
  </ul>
  <div class="row">
    {{ column_left }}
    <div id="content" class="col">
      {{ content_top }}

      <!-- Header Section -->
      <div class="row justify-content-center">
        <div class="col-lg-8 col-xl-7">
          <div class="text-center mb-5">
            <div class="icon-shape icon-xl bg-success bg-opacity-10 text-success rounded-circle mx-auto mb-3">
              <i class="fa-solid fa-lock fa-3x"></i>
            </div>
            <h1 class="display-6 fw-bold mb-3">{{ heading_title }}</h1>
            <p class="text-muted fs-5">Update your password to keep your account secure</p>
          </div>

          <!-- Password Change Card -->
          <div class="card border-0 shadow-sm">
            <div class="card-body p-4 p-md-5">
              <form id="form-password" action="{{ save }}" method="post" data-oc-toggle="ajax">
                <!-- Password Section -->
                <fieldset class="mb-5">
                  <div class="d-flex align-items-center mb-4 pb-3 border-bottom">
                    <div class="icon-shape bg-success bg-opacity-10 text-success rounded me-3">
                      <i class="fa-solid fa-key"></i>
                    </div>
                    <h3 class="h5 mb-0 fw-semibold">{{ text_password }}</h3>
                  </div>

                  <!-- Security Info Alert -->
                  <div class="alert alert-info border-0 d-flex align-items-start mb-4">
                    <div class="flex-shrink-0 me-3">
                      <i class="fa-solid fa-shield-halved fa-lg"></i>
                    </div>
                    <div class="flex-grow-1">
                      <h6 class="alert-heading mb-1">Password Security Guidelines</h6>
                      <p class="mb-0 small">Your password must be at least 4 characters long. For better security, use a mix of letters, numbers, and special characters.</p>
                    </div>
                  </div>

                  <div class="mb-4">
                    <label for="input-password" class="form-label fw-semibold">
                      {{ entry_password }} <span class="text-danger">*</span>
                    </label>
                    <div class="input-group input-group-lg">
                      <span class="input-group-text bg-light border-end-0">
                        <i class="fa-solid fa-key text-muted"></i>
                      </span>
                      <input type="password"
                             name="password"
                             value="{{ password }}"
                             placeholder="{{ entry_password }}"
                             id="input-password"
                             class="form-control border-start-0 ps-0"
                             required
                             autocomplete="new-password"
                             minlength="4"/>
                      <button type="button"
                              class="btn btn-light border-start-0"
                              onclick="togglePassword('input-password', this)">
                        <i class="fa-solid fa-eye"></i>
                      </button>
                    </div>
                    <div id="error-password" class="invalid-feedback d-block"></div>
                    <div class="form-text mt-2">
                      <i class="fa-solid fa-info-circle me-1"></i>
                      Enter your new password (minimum 4 characters)
                    </div>
                  </div>

                  <div class="mb-4">
                    <label for="input-confirm" class="form-label fw-semibold">
                      {{ entry_confirm }} <span class="text-danger">*</span>
                    </label>
                    <div class="input-group input-group-lg">
                      <span class="input-group-text bg-light border-end-0">
                        <i class="fa-solid fa-check-double text-muted"></i>
                      </span>
                      <input type="password"
                             name="confirm"
                             value="{{ confirm }}"
                             placeholder="{{ entry_confirm }}"
                             id="input-confirm"
                             class="form-control border-start-0 ps-0"
                             required
                             minlength="4"/>
                      <button type="button"
                              class="btn btn-light border-start-0"
                              onclick="togglePassword('input-confirm', this)">
                        <i class="fa-solid fa-eye"></i>
                      </button>
                    </div>
                    <div id="error-confirm" class="invalid-feedback d-block"></div>
                    <div class="form-text mt-2">
                      <i class="fa-solid fa-info-circle me-1"></i>
                      Confirm your new password
                    </div>
                  </div>

                  <!-- Password Strength Indicator -->
                  <div class="mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <small class="text-muted">Password Strength:</small>
                      <small id="strength-text" class="fw-semibold text-muted">Not Set</small>
                    </div>
                    <div class="progress" style="height: 6px;">
                      <div id="strength-bar"
                           class="progress-bar"
                           role="progressbar"
                           style="width: 0%"
                           aria-valuenow="0"
                           aria-valuemin="0"
                           aria-valuemax="100"></div>
                    </div>
                  </div>
                </fieldset>

                <!-- Action Buttons -->
                <div class="border-top pt-4 mt-4">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <a href="{{ back }}" class="btn btn-light btn-lg w-100 py-2">
                        <i class="fa-solid fa-arrow-left me-2"></i>{{ button_back }}
                      </a>
                    </div>
                    <div class="col-md-6">
                      <button type="submit" class="btn btn-success btn-lg w-100 py-3 fw-semibold">
                        <i class="fa-solid fa-save me-2"></i>{{ button_continue }}
                      </button>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      {{ content_bottom }}
    </div>
    {{ column_right }}
  </div>
</div>

<style>
/* Password Change Form Enhancements */
#account-password .icon-shape {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
}

#account-password .icon-shape.icon-xl {
  width: 80px;
  height: 80px;
}

#account-password .input-group-text {
  border-right: 0;
}

#account-password .input-group .form-control:focus {
  border-color: #dee2e6;
  box-shadow: none;
}

#account-password .input-group:focus-within .input-group-text {
  border-color: var(--bs-success);
  background-color: rgba(var(--bs-success-rgb), 0.05);
}

#account-password .card {
  border-radius: 12px;
}

#account-password fieldset {
  border: none;
}

#account-password .form-label.fw-semibold {
  color: #344767;
}

#account-password .bg-light {
  background-color: #f8f9fa !important;
}

#account-password .alert-info {
  background-color: rgba(var(--bs-info-rgb), 0.1);
  color: var(--bs-info);
}

#account-password .progress {
  background-color: #e9ecef;
  border-radius: 3px;
}

#account-password .btn.border-start-0:focus {
  box-shadow: none;
  border-color: #dee2e6 !important;
}

@media (max-width: 768px) {
  #account-password .icon-shape.icon-xl {
    width: 64px;
    height: 64px;
  }

  #account-password .card-body {
    padding: 1.5rem !important;
  }
}
</style>

<script>
// Toggle password visibility
function togglePassword(inputId, button) {
  const input = document.getElementById(inputId);
  const icon = button.querySelector('i');

  if (input.type === 'password') {
    input.type = 'text';
    icon.classList.remove('fa-eye');
    icon.classList.add('fa-eye-slash');
  } else {
    input.type = 'password';
    icon.classList.remove('fa-eye-slash');
    icon.classList.add('fa-eye');
  }
}

// Password strength checker
document.addEventListener('DOMContentLoaded', function() {
  const passwordInput = document.getElementById('input-password');
  const strengthBar = document.getElementById('strength-bar');
  const strengthText = document.getElementById('strength-text');

  if (passwordInput && strengthBar) {
    passwordInput.addEventListener('input', function() {
      const password = this.value;
      let strength = 0;

      if (password.length === 0) {
        strengthBar.style.width = '0%';
        strengthBar.className = 'progress-bar';
        strengthText.textContent = 'Not Set';
        strengthText.className = 'fw-semibold text-muted';
        return;
      }

      // Length check
      if (password.length >= 4) strength += 25;
      if (password.length >= 8) strength += 25;

      // Character variety checks
      if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength += 20;
      if (/\d/.test(password)) strength += 15;
      if (/[^a-zA-Z0-9]/.test(password)) strength += 15;

      strengthBar.style.width = strength + '%';

      if (strength < 30) {
        strengthBar.className = 'progress-bar bg-danger';
        strengthText.textContent = 'Weak';
        strengthText.className = 'fw-semibold text-danger';
      } else if (strength < 60) {
        strengthBar.className = 'progress-bar bg-warning';
        strengthText.textContent = 'Fair';
        strengthText.className = 'fw-semibold text-warning';
      } else if (strength < 80) {
        strengthBar.className = 'progress-bar bg-info';
        strengthText.textContent = 'Good';
        strengthText.className = 'fw-semibold text-info';
      } else {
        strengthBar.className = 'progress-bar bg-success';
        strengthText.textContent = 'Strong';
        strengthText.className = 'fw-semibold text-success';
      }
    });
  }
});
</script>

{{ footer }}
