{% if categories %}
  <!-- Enhanced Navigation Menu with Modern Design -->
  <div class="bg-white shadow-sm border-bottom">
    <div class="container">
      <nav id="menu" class="navbar navbar-expand-lg navbar-light py-0">
        <!-- Mobile Category Label -->
        <div id="category" class="d-block d-lg-none text-primary fw-bold py-2">
          <i class="fa-solid fa-bars me-2"></i>{{ text_category }}
        </div>

        <!-- Mobile Menu Toggle -->
        <button type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbar-menu"
                class="navbar-toggler border-0 shadow-none d-lg-none"
                aria-label="Toggle navigation"
                aria-expanded="false"
                aria-controls="navbar-menu">
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Navigation Menu Items -->
        <div id="navbar-menu" class="collapse navbar-collapse">
          <ul class="nav navbar-nav w-100 justify-content-start">
            {% for category in categories %}
              {% if category.children %}
                {% set total = category.children|length %}
                {% if total > 20 %}
                  {% set batch = (total / 4)|round(0, 'ceil') %}
                  {% set column = 4 %}
                {% else %}
                  {% set batch = 5 %}
                  {% set column = (total / 5)|round(0, 'ceil') %}
                {% endif %}

                <!-- Mega Menu Category with Children -->
                <li class="nav-item dropdown position-static">
                  <a href="{{ category.href }}"
                     class="nav-link dropdown-toggle px-3 py-3 text-dark fw-medium"
                     data-bs-toggle="dropdown"
                     aria-expanded="false"
                     role="button">
                    {{ category.name }}
                  </a>

                  <!-- Mega Dropdown Menu -->
                  <div class="dropdown-menu border-0 shadow-lg rounded-3 p-4 w-100 dropdown-column-{{ column }}">
                    <div class="dropdown-inner">
                      <div class="row g-3">
                        {% for children in category.children|batch(batch) %}
                          <div class="col-md-{{ 12 // column }}">
                            <ul class="list-unstyled mb-0">
                              {% for child in children %}
                                <li class="mb-2">
                                  <a href="{{ child.href }}"
                                     class="dropdown-item rounded-2 py-2 px-3 text-dark">
                                    <i class="fa-solid fa-angle-right fa-xs me-2 text-muted"></i>
                                    {{ child.name }}
                                  </a>
                                </li>
                              {% endfor %}
                            </ul>
                          </div>
                        {% endfor %}
                      </div>
                    </div>

                    <!-- View All Link -->
                    <hr class="my-3">
                    <div class="text-center">
                      <a href="{{ category.href }}"
                         class="btn btn-sm btn-outline-primary rounded-pill px-4">
                        <i class="fa-solid fa-th me-2"></i>{{ text_all }} {{ category.name }}
                      </a>
                    </div>
                  </div>
                </li>

              {% else %}
                <!-- Simple Category without Children -->
                <li class="nav-item">
                  <a href="{{ category.href }}"
                     class="nav-link px-3 py-3 text-dark fw-medium">
                    {{ category.name }}
                  </a>
                </li>
              {% endif %}
            {% endfor %}
          </ul>
        </div>
      </nav>
    </div>
  </div>
{% endif %}
