{{ header }}
<div id="shopping-cart" class="container py-5">
  <ul class="breadcrumb">
    {% for breadcrumb in breadcrumbs %}
      <li class="breadcrumb-item"><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
    {% endfor %}
  </ul>

  <div class="row">{{ column_left }}
    <div id="content" class="col">
      {{ content_top }}

      <h1 class="h2 font-weight-bold mb-4">{{ heading_title }}</h1>

      {% if attention %}
        <div class="alert alert-info"><i class="bi bi-info-circle"></i> {{ attention }}</div>
      {% endif %}

      {% if success %}
        <div class="alert alert-success alert-dismissible"><i class="bi bi-check-circle"></i> {{ success }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endif %}

      {% if error_warning %}
        <div class="alert alert-danger alert-dismissible"><i class="bi bi-exclamation-triangle"></i> {{ error_warning }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endif %}

      <div class="row">
        <div class="col-lg-8">
          <div class="card border-0 shadow-xs mb-4">
            <div class="card-body p-4">
              <h5 class="card-title mb-4">Shopping Cart ({{ product_count }} items)</h5>

              <form id="form-cart">
                {% if products %}
                  {% for product in products %}
                    {% include 'cart/components/cart_item.twig' with {
                      'key': product.cart_id,
                      'thumb': product.thumb,
                      'name': product.name,
                      'option': product.option,
                      'quantity': product.quantity,
                      'stock': product.stock,
                      'total': product.total,
                      'href': product.href
                    } %}
                  {% endfor %}
                {% else %}
                  <div class="text-center py-5">
                    <i class="bi bi-cart-x" style="font-size: 4rem; opacity: 0.3;"></i>
                    <h5 class="mt-3 text-muted">{{ text_no_results }}</h5>
                    <p class="text-muted">{{ text_empty }}</p>
                    <a href="{{ continue }}" class="btn btn-primary mt-3">{{ button_continue }}</a>
                  </div>
                {% endif %}
              </form>

              {% if products %}
                <div class="d-flex justify-content-between mt-4">
                  <a href="{{ continue }}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> {{ button_shopping }}
                  </a>
                  <button type="button" class="btn btn-outline-danger" onclick="cart.clear();">
                    <i class="bi bi-trash"></i> Clear Cart
                  </button>
                </div>
              {% endif %}
            </div>
          </div>

          {# Coupon / Voucher / Reward Points #}
          {% if modules %}
            <div class="card border-0 shadow-xs mb-4">
              <div class="card-body p-4">
                <h5 class="card-title mb-4">Discounts & Rewards</h5>
                {{ modules }}
              </div>
            </div>
          {% endif %}
        </div>

        <div class="col-lg-4">
          {% if products %}
            {% include 'cart/components/order_summary.twig' with {
              'sub_total': sub_total,
              'totals': totals,
              'total': total,
              'checkout': checkout,
              'checkout_button': true,
              'textColor': 'dark'
            } %}
          {% endif %}
        </div>
      </div>

      {{ content_bottom }}
    </div>
    {{ column_right }}
  </div>
</div>

<script>
$(document).ready(function() {
  // Update cart on quantity change
  $('[data-cart-update]').on('change', function() {
    var key = $(this).data('cart-update');
    var quantity = $(this).val();

    $.ajax({
      url: 'index.php?route=checkout/cart.edit',
      type: 'post',
      data: 'key=' + key + '&quantity=' + quantity,
      dataType: 'json',
      success: function(json) {
        location.reload();
      }
    });
  });

  // Remove from cart
  $('[data-cart-remove]').on('click', function() {
    var key = $(this).data('cart-remove');

    $.ajax({
      url: 'index.php?route=checkout/cart.remove',
      type: 'post',
      data: 'key=' + key,
      dataType: 'json',
      success: function(json) {
        location.reload();
      }
    });
  });
});

// Clear cart
cart.clear = function() {
  if (confirm('Are you sure you want to clear your cart?')) {
    $.ajax({
      url: 'index.php?route=checkout/cart.clear',
      type: 'post',
      dataType: 'json',
      success: function(json) {
        location.reload();
      }
    });
  }
};
</script>
{{ footer }}
